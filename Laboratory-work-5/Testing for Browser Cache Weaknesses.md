# Тестування на недоліки кешу браузера

## Опис
На цьому етапі тестувальник перевіряє, чи правильно програма вказує браузеру не зберігати конфіденційні дані.

Браузери можуть зберігати інформацію з метою кешування та історії. Кешування використовується для покращення продуктивності, тому попередньо відображену інформацію не потрібно завантажувати знову. Механізми історії використовуються для зручності користувача, тому користувач може бачити саме те, що він бачив у момент отримання ресурсу. Якщо конфіденційна інформація відображається користувачеві (наприклад, його адреса, дані кредитної картки, номер соціального страхування або ім’я користувача), то ця інформація може зберігатися для цілей кешування чи історії, і тому її можна буде відновити шляхом перевірки кешу веб-переглядача або просто натисканням кнопки «Назад» у браузері.

## Цілі тесту

Перевірте, чи програма зберігає конфіденційну інформацію на стороні клієнта.
Перегляньте, чи можливий доступ без авторизації.

## Як тестувати

### Історія браузера

Технічно кнопка «Назад» — це історія, а не кеш (див. Кешування в HTTP: списки історії). Кеш і історія — це дві різні сутності. Однак вони мають ту саму слабкість у представленні раніше відображеної конфіденційної інформації.

Перший і найпростіший тест полягає у введенні конфіденційної інформації в додаток і виході з нього. Потім тестувальник натискає кнопку «Назад» у веб-переглядачі, щоб перевірити, чи можна отримати доступ до попередньо відображеної конфіденційної інформації без автентифікації.

Якщо, натиснувши кнопку «Назад», тестувальник може отримати доступ до попередніх сторінок, але не має доступу до нових, це означає, що проблема не в автентифікації, а в історії браузера. Якщо ці сторінки містять конфіденційні дані, це означає, що програма не забороняла браузеру їх зберігати.
Автентифікація не обов’язково бере участь у тестуванні. Наприклад, коли користувач вводить свою адресу електронної пошти, щоб підписатися на інформаційний бюлетень, цю інформацію можна буде відновити, якщо її не обробляти належним чином.

Кнопку «Назад» можна припинити показувати конфіденційні дані. Це можна зробити:

Доставка сторінки через HTTPS.
Налаштування `Cache-Control: must-revalidate`

### Кеш браузера

Тут тестувальники перевіряють, чи програма не витікає конфіденційних даних у кеш браузера. Для цього вони можуть використовувати проксі-сервер (наприклад, OWASP ZAP) і здійснювати пошук серед відповідей сервера, які належать до сеансу, перевіряючи, чи для кожної сторінки, яка містить конфіденційну інформацію, сервер наказав браузеру не кешувати дані. Така директива може бути видана в заголовках відповіді HTTP за допомогою таких директив:

- `Cache-Control: no-cache, no-store`
- `Expires: 0`
- `Pragma: no-cache`

Ці директиви, як правило, надійні, хоча для заголовка Cache-Control можуть знадобитися додаткові позначки, щоб краще запобігти постійно пов’язаним файлам у файловій системі. До них належать:
- `Cache-Control: must-revalidate, max-age=0, s-maxage=0`

Наприклад, якщо тестувальники тестують програму електронної комерції, вони повинні шукати всі сторінки, які містять номер кредитної картки або іншу фінансову інформацію, і перевірити, чи всі ці сторінки забезпечують виконання директиви про відсутність кешу. Якщо вони знаходять сторінки, які містять важливу інформацію, але не вказують веб-переглядачу не кешувати їхній вміст, вони знають, що конфіденційна інформація буде зберігатися на диску, і вони можуть ще раз перевірити це, просто знайшовши сторінку в кеші браузера .

Точне місце, де зберігається ця інформація, залежить від операційної системи клієнта та браузера, який використовувався. Ось кілька прикладів:

- Mozilla Firefox:
  - Unix/Linux: `~/.cache/mozilla/firefox/`
  - Windows: `C:\Users\<ім'я_користувача>\AppData\Local\Mozilla\Firefox\Profiles\<id-профілю>\Cache2\`
- Internet Explorer:
  - `C:\Users\<ім'я_користувача>\AppData\Local\Microsoft\Windows\INetCache\`
- Chrome:
  - Windows: `C:\Users\<ім'я_користувача>\AppData\Local\Google\Chrome\User Data\Default\Cache` 
  - Unix/Linux: `~/.cache/google-chrome`

### Перегляд кешованої інформації

Firefox надає функціональність для перегляду кешованої інформації, яка може бути корисною для вас як тестувальника. Звичайно, індустрія також випустила різні розширення та зовнішні програми, які ви можете віддати перевагу або знадобитися для Chrome, Internet Explorer або Edge.

Деталі кешу також доступні через інструменти розробника в більшості сучасних браузерів, таких як Firefox, Chrome і Edge. У Firefox також можна використовувати URL about:cache для перевірки деталей кешу.

### Перевірка обробки для мобільних браузерів

Обробка директив кешу може бути зовсім іншою для мобільних браузерів. Тому тестувальники повинні розпочати новий сеанс веб-перегляду з чистими кеш-пам’ятами та скористатися перевагами таких функцій, як режим пристрою Chrome або адаптивний режим дизайну Firefox, щоб повторно або окремо протестувати концепції, викладені вище.

Крім того, персональні проксі-сервери, такі як ZAP і Burp Suite, дозволяють тестувальнику вказати, який User-Agent має бути надісланий їхніми павуками/сканерами. Це можна налаштувати так, щоб відповідати рядку User-Agent мобільного браузера та використовувати для того, щоб побачити, які директиви кешування надсилає програма, що тестується.

## Тестування методом "сірого ящика"

Методологія тестування еквівалентна випадку чорної скриньки, оскільки в обох сценаріях тестувальники мають повний доступ до заголовків відповіді сервера та до HTML-коду. Однак під час тестування в сірому полі тестувальник може мати доступ до облікових даних облікового запису, що дозволить йому тестувати конфіденційні сторінки, доступні лише для автентифікованих користувачів.
